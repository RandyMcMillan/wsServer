<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>wsServer | a very tiny WebSocket server library written in C</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,600,600i%7CSource+Code+Pro:400,400i,600" />
  <link rel="stylesheet" href="m-dark+documentation.compiled.css" />
  <link rel="icon" href="favicon-dark.png" type="image/png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#22272e" />
  <style>
    li {margin-top: 10px;}
  </style>
</head>
<body>
<header><nav id="navigation">
  <div class="m-container">
    <div class="m-row">
      <a href="index.html" id="m-navbar-brand" class="m-col-t-8 m-col-m-none m-left-m">wsServer <span class="m-thin">| a very tiny WebSocket server library written in C</span></a>
      <div class="m-col-t-4 m-hide-m m-text-right m-nopadr">
        <a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
          <path id="m-doc-search-icon-path" d="m6 0c-3.31 0-6 2.69-6 6 0 3.31 2.69 6 6 6 1.49 0 2.85-0.541 3.89-1.44-0.0164 0.338 0.147 0.759 0.5 1.15l3.22 3.79c0.552 0.614 1.45 0.665 2 0.115 0.55-0.55 0.499-1.45-0.115-2l-3.79-3.22c-0.392-0.353-0.812-0.515-1.15-0.5 0.895-1.05 1.44-2.41 1.44-3.89 0-3.31-2.69-6-6-6zm0 1.56a4.44 4.44 0 0 1 4.44 4.44 4.44 4.44 0 0 1-4.44 4.44 4.44 4.44 0 0 1-4.44-4.44 4.44 4.44 0 0 1 4.44-4.44z"/>
        </svg></a>
        <a id="m-navbar-show" href="#navigation" title="Show navigation"></a>
        <a id="m-navbar-hide" href="#" title="Hide navigation"></a>
      </div>
      <div id="m-navbar-collapse" class="m-col-t-12 m-show-m m-col-m-none m-right-m">
        <div class="m-row">
          <ol class="m-col-t-6 m-col-m-none">
            <li><a href="pages.html">Pages</a></li>
            <li><a href="namespaces.html">Namespaces</a></li>
          </ol>
          <ol class="m-col-t-6 m-col-m-none" start="3">
            <li><a href="annotated.html">Classes</a></li>
            <li><a href="files.html">Files</a></li>
            <li class="m-show-m"><a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
              <use href="#m-doc-search-icon-path" />
            </svg></a></li>
            <li class="m-show-m"><a target="_blank" href="https://github.com/Theldus/wsServer" class="m-doc-search-icon" title="GitHub Page">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
            </a></li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</nav></header>
<main><article>
  <div class="m-container m-container-inflatable">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <h1>
          wsServer
        </h1>
<p><a name="md_README"></a><a href="https://opensource.org/licenses/GPL-3.0"><img class="m-image" src="https://img.shields.io/badge/license-GPLv3-blue" alt="Image" /></a> <a href="https://app.travis-ci.com/Theldus/wsServer"><img class="m-image" src="https://app.travis-ci.com/Theldus/wsServer.svg?branch=master" alt="Image" /></a></p><p>wsServer - a very tiny WebSocket server library written in C</p><section id="autotoc_md48"><h2><a href="#autotoc_md48">Library</a></h2><p>wsServer is a tiny, lightweight WebSocket server library written in C that intends to be easy to use, fast, hackable, and compliant to the <a href="https://tools.ietf.org/html/rfc6455">RFC 6455</a>.</p><p>The main features are:</p><ul><li>Send/Receive Text and Binary messages</li><li>PING/PONG frames</li><li>Opening/Closing handshakes</li><li>Event based (onmessage, onopen, onclose)</li><li>Portability: Works fine on Windows, Linux (Android included), macOS and FreeBSD</li></ul><p>See Autobahn <a href="https://theldus.github.io/wsServer/autobahn">report</a> and the <a href="md_doc_AUTOBAHN.html" class="m-doc">docs</a> for an &#x27;in-depth&#x27; analysis.</p></section><section id="autotoc_md49"><h2><a href="#autotoc_md49">Building</a></h2><p>wsServer only requires a C99-compatible compiler (such as GCC, Clang, TCC and others) and no external libraries.</p><section id="autotoc_md50"><h3><a href="#autotoc_md50">Make</a></h3><p>The preferred way to build wsServer on Linux environments:</p><pre class="m-code">git clone https://github.com/Theldus/wsServer
<span class="nb">cd</span> wsServer/
make

<span class="c1"># Optionally, a user can also install wsServer into the system,</span>
<span class="c1"># either on default paths or by providing PREFIX or DESTDIR env</span>
<span class="c1"># vars to the Makefile.</span>

make install <span class="c1"># Or make install DESTDIR=/my/folder/</span></pre></section><section id="autotoc_md51"><h3><a href="#autotoc_md51">CMake</a></h3><p>CMake enables the user to easily build wsServer in others environments other than Linux and also allows the use of an IDE to build the project automatically. If that&#x27;s your case:</p><pre class="m-code">git clone https://github.com/Theldus/wsServer
<span class="nb">cd</span> wsServer/
mkdir build <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build/
cmake ..
make
./examples/echo/echo <span class="c1"># Waiting for incoming connections...</span></pre></section><section id="autotoc_md52"><h3><a href="#autotoc_md52">Windows support</a></h3><p>Windows has native support via MinGW, toolchain setup and build steps are detailed <a href="https://github.com/Theldus/wsServer/blob/master/doc/BUILD_WINDOWS.md">here</a>.</p></section></section><section id="autotoc_md53"><h2><a href="#autotoc_md53">Why to complicate if things can be simple?</a></h2><p>wsServer abstracts the idea of sockets and you only need to deal with three types of events defined:</p><pre class="m-code"><span class="cm">/* New client. */</span>
<span class="kt">void</span> <span class="nf">onopen</span><span class="p">(</span><span class="n">ws_cli_conn_t</span> <span class="o">*</span><span class="n">client</span><span class="p">);</span>

<span class="cm">/* Client disconnected. */</span>
<span class="kt">void</span> <span class="nf">onclose</span><span class="p">(</span><span class="n">ws_cli_conn_t</span> <span class="o">*</span><span class="n">client</span><span class="p">);</span>

<span class="cm">/* Client sent a text message. */</span>
<span class="kt">void</span> <span class="nf">onmessage</span><span class="p">(</span><span class="n">ws_cli_conn_t</span> <span class="o">*</span><span class="n">client</span><span class="p">,</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">msg</span><span class="p">,</span>
    <span class="kt">uint64_t</span> <span class="n">size</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">);</span></pre><p>this is all you need to worry about, nothing to think about return values in socket, accepting connections, and so on.</p><p>As a gift, each client is handled in a separate thread, so you will not have to worry about it.</p><section id="autotoc_md54"><h3><a href="#autotoc_md54">A complete example</a></h3><p>More examples, including the respective html files, can be found in examples/ folder, ;-).</p><pre class="m-code"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;ws.h&gt;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">onopen</span><span class="p">(</span><span class="n">ws_cli_conn_t</span> <span class="o">*</span><span class="n">client</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">cli</span><span class="p">;</span>
    <span class="n">cli</span> <span class="o">=</span> <span class="n">ws_getaddress</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Connection opened, addr: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">cli</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">onclose</span><span class="p">(</span><span class="n">ws_cli_conn_t</span> <span class="o">*</span><span class="n">client</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">cli</span><span class="p">;</span>
    <span class="n">cli</span> <span class="o">=</span> <span class="n">ws_getaddress</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Connection closed, addr: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">cli</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">onmessage</span><span class="p">(</span><span class="n">ws_cli_conn_t</span> <span class="o">*</span><span class="n">client</span><span class="p">,</span>
    <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">msg</span><span class="p">,</span> <span class="kt">uint64_t</span> <span class="n">size</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">cli</span><span class="p">;</span>
    <span class="n">cli</span> <span class="o">=</span> <span class="n">ws_getaddress</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;I receive a message: %s (%zu), from: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span>
        <span class="n">size</span><span class="p">,</span> <span class="n">cli</span><span class="p">);</span>

    <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">ws_sendframe_txt</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="s">&quot;hello&quot;</span><span class="p">);</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">ws_sendframe_txt</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="s">&quot;world&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="cm">/* Register events. */</span>
    <span class="k">struct</span> <span class="n">ws_events</span> <span class="n">evs</span><span class="p">;</span>
    <span class="n">evs</span><span class="p">.</span><span class="n">onopen</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">onopen</span><span class="p">;</span>
    <span class="n">evs</span><span class="p">.</span><span class="n">onclose</span>   <span class="o">=</span> <span class="o">&amp;</span><span class="n">onclose</span><span class="p">;</span>
    <span class="n">evs</span><span class="p">.</span><span class="n">onmessage</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">onmessage</span><span class="p">;</span>

    <span class="cm">/*</span>
<span class="cm">     * Main loop, this function never* returns.</span>
<span class="cm">     *</span>
<span class="cm">     * *If the third argument is != 0, a new thread is created</span>
<span class="cm">     * to handle new connections.</span>
<span class="cm">     */</span>
    <span class="n">ws_socket</span><span class="p">(</span><span class="o">&amp;</span><span class="n">evs</span><span class="p">,</span> <span class="mi">8080</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

    <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span></pre><p>the example above can be built with: <code>make examples</code>.</p></section></section><section id="autotoc_md55"><h2><a href="#autotoc_md55">WebSocket client: ToyWS</a></h2><p>Inside <code>extra/toyws</code> there is a companion project called ToyWS. ToyWS is a very simple &amp; dumb WebSocket client made exclusively to work with wsServer. Extremely limited, its usage is highly discouraged with other servers other than wsServer and is only meant to be used in conjunction with wsServer.</p><p>This mini-project only serves as an aid to wsServer and frees the user from using additional projects to use wsServer in its entirety.</p><p>More info at: <a href="md_extra_toyws_README.html" class="m-doc">extra/<wbr />toyws/<wbr />README.md</a></p></section><section id="autotoc_md56"><h2><a href="#autotoc_md56">SSL/TLS Support</a></h2><p>wsServer does not currently support encryption. However, it is possible to use it in conjunction with <a href="https://www.stunnel.org/">Stunnel</a>, a proxy that adds TLS support to existing projects. Just follow <a href="md_doc_TLS.html" class="m-doc">these</a> four easy steps to get TLS support on wsServer.</p></section><section id="autotoc_md57"><h2><a href="#autotoc_md57">Contributing</a></h2><p>wsServer is always open to the community and willing to accept contributions, whether with issues, documentation, testing, new features, bugfixes, typos... welcome aboard. Make sure to read the <a href="md_doc_CODING_STYLE.html" class="m-doc">coding-style</a> guidelines before sending a PR.</p><p>Was the project helpful to you? Have something to say about it? Leave your comments <a href="https://github.com/Theldus/wsServer/discussions/30">here</a>.</p></section><section id="autotoc_md58"><h2><a href="#autotoc_md58">License and Authors</a></h2><p>wsServer is licensed under GPLv3 License. Written by Davidson Francis and <a href="https://github.com/Theldus/wsServer/graphs/contributors">others</a> contributors.</p></section>
      </div>
    </div>
  </div>
</article></main>
<div class="m-doc-search" id="search">
  <a href="#!" onclick="return hideSearch()"></a>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-m-8 m-push-m-2">
        <div class="m-doc-search-header m-text m-small">
          <div><span class="m-label m-default">Tab</span> / <span class="m-label m-default">T</span> to search, <span class="m-label m-default">Esc</span> to close</div>
          <div id="search-symbolcount">&hellip;</div>
        </div>
        <div class="m-doc-search-content">
          <form>
            <input type="search" name="q" id="search-input" placeholder="Loading &hellip;" disabled="disabled" autofocus="autofocus" autocomplete="off" spellcheck="false" />
          </form>
          <noscript class="m-text m-danger m-text-center">Unlike everything else in the docs, the search functionality <em>requires</em> JavaScript.</noscript>
          <div id="search-help" class="m-text m-dim m-text-center">
            <p class="m-noindent">Search for symbols, directories, files, pages or
            modules. You can omit any prefix from the symbol or file path; adding a
            <code>:</code> or <code>/</code> suffix lists all members of given symbol or
            directory.</p>
            <p class="m-noindent">Use <span class="m-label m-dim">&darr;</span>
            / <span class="m-label m-dim">&uarr;</span> to navigate through the list,
            <span class="m-label m-dim">Enter</span> to go.
            <span class="m-label m-dim">Tab</span> autocompletes common prefix, you can
            copy a link to the result using <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">L</span> while <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">M</span> produces a Markdown link.</p>
          </div>
          <div id="search-notfound" class="m-text m-warning m-text-center">Sorry, nothing was found.</div>
          <ul id="search-results"></ul>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="search-v1.js"></script>
<script src="searchdata-v1.js" async="async"></script>
<footer><nav>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <p>wsServer | a very tiny WebSocket server library written in C. Created with <a href="https://doxygen.org/">Doxygen</a> 1.8.20 and <a href="https://mcss.mosra.cz/">m.css</a>.</p>
      </div>
    </div>
  </div>
</nav></footer>
</body>
</html>
